name: Build and Test

on:
  push:
    branches:
      - main

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    
    steps:
      - name: Print the build number ✍🏻
        run: echo "Build number is Something"

      - name: Print Current Working Directory ☝🏻
        run: echo "PWD is" && pwd

      - name: Checkout code 📤
        uses: actions/checkout@v4
        
      - name: Setup .NET ⚙
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.x'
      
      - name: Dotnet Restore 🗒
        run: dotnet restore DemoWebAppSC/DemoWebAppSC.csproj
        
      - name: Build project 🏰
        run: dotnet build DemoWebAppSC/DemoWebAppSC.csproj
      
      - name: publish project 🗞
        run: dotnet publish DemoWebAppSC/DemoWebAppSC.csproj -c Release -o ./publish

      - name: SCP to EC2 Instance
        uses: appleboy/scp-action@master
        with:
          host: '3.213.39.34'
          username: 'ubuntu'
          key: "C:/Users/Santosh/Downloads/ls-rywds-dev-01-aryawoods-private.ppk"
          port: 22
          source: ./publish/
          target: /usr/devscapps/pomodoro/